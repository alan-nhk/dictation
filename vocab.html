<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¸æ ¡ç”Ÿè©å¡ (æ¥µç°¡ç‰ˆ)</title>
    <style>
        :root {
            --primary-color: #4facfe;
            --secondary-color: #00f2fe;
            --accent-color: #ff9a9e;
            --text-color: #333;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            background-image: linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%);
            min-height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            text-align: center;
            width: 100%;
            max-width: 600px;
        }

        /* å…©ç¨®æ¨¡å¼åˆ‡æ› */
        .mode-section {
            display: none; /* é è¨­éš±è—ï¼Œç”± JS æ§åˆ¶é¡¯ç¤º */
            animation: fadeIn 0.5s;
        }

        .mode-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ç·¨è¼¯å€æ¨£å¼ */
        .edit-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: left;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 15px;
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            box-sizing: border-box;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        select, input[type="range"] {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #ddd;
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .helper-text {
            font-size: 0.9rem;
            color: #888;
            margin-top: 5px;
            line-height: 1.5;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
        }

        /* å­¸ç¿’å¡æ¨£å¼ (ä¿æŒåŸæ¨£ä½†å¾®èª¿) */
        .card {
            background: var(--card-bg);
            border-radius: 30px;
            padding: 40px 20px;
            box-shadow: 0 15px 35px rgba(50, 50, 93, 0.1), 0 5px 15px rgba(0, 0, 0, 0.07);
            position: relative;
            transition: transform 0.3s ease;
            margin-bottom: 20px;
            min-height: 300px; /* ç¢ºä¿é«˜åº¦è¶³å¤ ï¼Œè¦–è¦ºä¸Šæ›´èˆ’æœ */
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* éŸ³ç¯€é¡¯ç¤ºå€ */
        .syllable-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            margin: 20px 0 40px 0; /* å¢åŠ ä¸‹æ–¹é–“è· */
            cursor: pointer;
            flex-grow: 1; /* è®“éŸ³ç¯€å€å¡Šä½”æ“šä¸­é–“ç©ºé–“ */
            align-items: center;
        }

        .syllable {
            font-size: 3.8rem; /* å­—é«”ç¨å¾®åŠ å¤§ */
            font-weight: bold;
            padding: 8px 15px;
            border-radius: 15px;
            transition: all 0.2s;
            user-select: none;
        }

        .syllable:nth-child(odd) { color: #2b5876; background-color: #e6f1f9; }
        .syllable:nth-child(even) { color: #d9475c; background-color: #ffe6e9; }
        .syllable:active { transform: scale(0.95); background-color: #ffff00; }

        .chinese-meaning {
            font-size: 1.8rem;
            color: #666;
            margin-bottom: 20px;
            font-weight: 500;
            min-height: 1.8rem; /* å³ä½¿éš±è—ä¹Ÿä¿ç•™ä¸€é»ç©ºé–“é¿å…è·³å‹•éå¤§? ä¸ï¼Œéš±è—æ¯”è¼ƒå¥½ */
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: auto; /* æ¨åˆ°åº•éƒ¨ */
        }

        .btn {
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.2s;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
        }

        .btn:active { transform: scale(0.95); }
        
        .btn-primary { background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%); }
        .btn-success { background: linear-gradient(to right, #43e97b 0%, #38f9d7 100%); color: #333; }
        .btn-warning { background: linear-gradient(to right, #fa709a 0%, #fee140 100%); }
        .btn-secondary { background: #eee; color: #555; }

        .edit-btn-container {
            margin-top: 20px;
        }

        /* æ‰‹æ©Ÿç‰ˆèª¿æ•´ */
        @media (max-width: 600px) {
            .syllable { font-size: 2.5rem; }
            .card { padding: 30px 15px; min-height: 250px; }
            .btn { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>

    <div class="container">
        
        <!-- 1. ç·¨è¼¯èˆ‡è¨­å®šæ¨¡å¼ -->
        <div id="editMode" class="mode-section active">
            <h1 style="color:white; text-shadow: 1px 1px 2px rgba(0,0,0,0.2);">ğŸ“ è¨­å®šç”Ÿè©</h1>
            
            <div class="edit-card">
                <div class="input-group">
                    <label for="wordInput">è¼¸å…¥ç”Ÿè© (ä¸€è¡Œä¸€å€‹ï¼Œä¸éœ€ä¸­æ–‡)</label>
                    <div class="helper-text">
                        <b>ğŸ”¥ æ¥µç°¡æ¨¡å¼ï¼š</b><br>
                        ç›´æ¥è¼¸å…¥è‹±æ–‡å³å¯ï¼Œç³»çµ±æœƒè‡ªå‹•æ‹†éŸ³ç¯€ã€‚<br>
                        ä¾‹å¦‚ï¼š<br>
                        <code>experiment</code><br>
                        <code>classroom</code>
                    </div>
                    <textarea id="wordInput" placeholder="experiment&#10;classroom&#10;music room"></textarea>
                </div>

                <div class="input-group">
                    <label for="voiceSelect">é¸æ“‡ç™¼éŸ³ (Voice)</label>
                    <select id="voiceSelect">
                        <option value="">è¼‰å…¥èªéŸ³ä¸­...</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="rateRange">æœ—è®€é€Ÿåº¦ (Speed): <span id="rateValue">0.8</span></label>
                    <input type="range" id="rateRange" min="0.5" max="1.5" step="0.1" value="0.8">
                </div>

                <button class="btn btn-success" onclick="startLearning()" style="width:100%; justify-content: center;">
                    é–‹å§‹å­¸ç¿’ (Start) â–¶
                </button>
            </div>
        </div>

        <!-- 2. å­¸ç¿’å¡ç‰‡æ¨¡å¼ -->
        <div id="learningMode" class="mode-section">
            <h1 id="title">ğŸ« å­¸ç¿’ä¸­</h1>
            
            <div class="card">
                <!-- ä¸­æ–‡æ„æ€ (å¦‚æœæœ‰è¼¸å…¥æ‰æœƒé¡¯ç¤ºï¼Œæ²’æœ‰å‰‡éš±è—) -->
                <div class="chinese-meaning" id="chineseText" style="display:none;"></div>
                
                <div class="syllable-container" id="syllableBox" onclick="speakCurrentWord()">
                    <span class="syllable" style="background:none; color:#333;">Start!</span>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" onclick="speakCurrentWord()">
                        <span>ğŸ”Š</span> è®€éŸ³
                    </button>
                    <button class="btn btn-warning" onclick="nextWord()">
                        ä¸‹ä¸€å€‹ <span>â¡</span>
                    </button>
                </div>
            </div>

            <div class="edit-btn-container">
                <button class="btn btn-secondary" onclick="showEditMode()" style="background: rgba(255,255,255,0.3); color: white;">
                    âœï¸ ä¿®æ”¹ç”Ÿè© / è¨­å®š
                </button>
            </div>
            <div style="margin-top:10px; color: white;" id="progressText"></div>
        </div>

    </div>

    <script>
        // é è¨­è³‡æ–™ (ç´”è‹±æ–‡ï¼Œä¸å¸¶ä¸­æ–‡è§£é‡‹)
        const defaultData = `experiment
classroom
music room
computer room
library
playground
washrooms`;

        let wordList = [];
        let currentIndex = -1;
        let selectedVoice = null;
        
        // åˆå§‹åŒ–
        window.onload = function() {
            document.getElementById('wordInput').value = defaultData;
            loadVoices();
            
            // ç›£è½èªé€Ÿæ‹‰æ¡¿è®ŠåŒ–
            document.getElementById('rateRange').addEventListener('input', function(e) {
                document.getElementById('rateValue').innerText = e.target.value;
            });
        };

        // -----------------------
        // æ ¸å¿ƒåŠŸèƒ½ï¼šè‡ªå‹•éŸ³ç¯€æ‹†è§£
        // -----------------------
        function autoHyphenate(text) {
            // å¦‚æœä½¿ç”¨è€…å·²ç¶“æ‰‹å‹•è¼¸å…¥äº† "-"ï¼Œæˆ‘å€‘å°±å°Šé‡ä½¿ç”¨è€…çš„æ±ºå®š
            if (text.includes('-')) return text;

            // å¦‚æœæ˜¯ç‰‡èª (æœ‰ç©ºæ ¼)ï¼Œåˆ†é–‹è™•ç†æ¯å€‹å­—
            if (text.includes(' ')) {
                return text.split(' ').map(word => autoHyphenate(word)).join(' ');
            }

            const word = text.toLowerCase();
            if (word.length <= 4) return text; // å¤ªçŸ­çš„å­—é€šå¸¸ä¸ç”¨æ‹†

            // ä½¿ç”¨æ­£å‰‡è¡¨é”å¼é€²è¡Œæ¨ä¼°
            const syllableRegex = /[^aeiouy]*[aeiouy]+(?:[^aeiouy]*$|[^aeiouy](?=[^aeiouy]))?/gi;
            const chunks = word.match(syllableRegex);

            if (chunks && chunks.length > 1) {
                return chunks.join('-');
            } else {
                return text;
            }
        }

        // 1. è¼‰å…¥èªéŸ³åˆ—è¡¨
        function loadVoices() {
            const voiceSelect = document.getElementById('voiceSelect');
            
            function populate() {
                const voices = window.speechSynthesis.getVoices();
                voiceSelect.innerHTML = '';
                
                // ç¯©é¸å‡ºè‹±æ–‡èªéŸ³
                const englishVoices = voices.filter(v => v.lang.startsWith('en'));
                const voicesToShow = englishVoices.length > 0 ? englishVoices : voices;

                voicesToShow.forEach((voice, index) => {
                    const option = document.createElement('option');
                    option.textContent = `${voice.name} (${voice.lang})`;
                    option.value = index;
                    if (voice.name.includes('Google US') || voice.name.includes('Zira')) {
                        option.selected = true;
                    }
                    voiceSelect.appendChild(option);
                });

                if (voices.length === 0) {
                    const option = document.createElement('option');
                    option.textContent = "æœªåµæ¸¬åˆ°èªéŸ³ï¼Œå°‡ä½¿ç”¨é è¨­å€¼";
                    voiceSelect.appendChild(option);
                }
            }

            populate();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = populate;
            }
        }

        // 2. è§£æè¼¸å…¥ä¸¦é–‹å§‹å­¸ç¿’
        function startLearning() {
            const rawInput = document.getElementById('wordInput').value;
            const lines = rawInput.split('\n');
            wordList = [];

            lines.forEach(line => {
                line = line.trim(); // å»é™¤å‰å¾Œç©ºç™½
                if (!line) return;  // è·³éç©ºè¡Œ

                let englishPart = line;
                let meaningPart = ""; // é è¨­æ²’æœ‰ä¸­æ–‡æ„æ€

                // æª¢æŸ¥æ˜¯å¦åŒ…å«å†’è™Ÿ (å¦‚æœä½¿ç”¨è€…æƒ³åŠ ä¸­æ–‡ï¼Œé‚„æ˜¯æ”¯æ´)
                if (line.includes(':') || line.includes('ï¼š')) {
                    let separator = line.includes(':') ? ':' : 'ï¼š';
                    const parts = line.split(separator);
                    englishPart = parts[0];
                    if (parts.length > 1) {
                        meaningPart = parts[1];
                    }
                }

                if (englishPart) {
                    const cleanEnglish = englishPart.trim();
                    const cleanMeaning = meaningPart.trim();
                    const fullWord = cleanEnglish.replace(/-/g, ''); // æœ—è®€ç”¨çš„å®Œæ•´å–®å­—
                    
                    // è‡ªå‹•æ‹†è§£åŠŸèƒ½
                    const hyphenatedText = autoHyphenate(cleanEnglish);

                    wordList.push({
                        text: hyphenatedText,
                        chinese: cleanMeaning,
                        full: fullWord
                    });
                }
            });

            if (wordList.length === 0) {
                alert("è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹ç”Ÿè©ï¼");
                return;
            }

            // ç²å–é¸æ“‡çš„èªéŸ³ç‰©ä»¶
            const voices = window.speechSynthesis.getVoices();
            const englishVoices = voices.filter(v => v.lang.startsWith('en'));
            const voicesToShow = englishVoices.length > 0 ? englishVoices : voices;
            
            const selectedIndex = document.getElementById('voiceSelect').selectedIndex;
            if (selectedIndex >= 0 && selectedIndex < voicesToShow.length) {
                selectedVoice = voicesToShow[selectedIndex];
            } else {
                selectedVoice = null;
            }

            document.getElementById('editMode').classList.remove('active');
            document.getElementById('learningMode').classList.add('active');
            
            currentIndex = 0;
            updateDisplay();
            setTimeout(speakCurrentWord, 500);
        }

        // 3. è¿”å›ç·¨è¼¯æ¨¡å¼
        function showEditMode() {
            document.getElementById('learningMode').classList.remove('active');
            document.getElementById('editMode').classList.add('active');
            window.speechSynthesis.cancel();
        }

        // 4. ä¸‹ä¸€å€‹å­—
        function nextWord() {
            currentIndex++;
            if (currentIndex >= wordList.length) {
                currentIndex = 0;
            }
            updateDisplay();
            setTimeout(speakCurrentWord, 300);
        }

        // 5. æ›´æ–°ç•«é¢é¡¯ç¤º
        function updateDisplay() {
            const wordData = wordList[currentIndex];
            const syllableBox = document.getElementById('syllableBox');
            const chineseText = document.getElementById('chineseText');
            const progressText = document.getElementById('progressText');

            // é‚è¼¯ï¼šå¦‚æœæœ‰ä¸­æ–‡æ‰é¡¯ç¤ºï¼Œæ²’æœ‰å°±éš±è—
            if (wordData.chinese) {
                chineseText.innerText = wordData.chinese;
                chineseText.style.display = 'block';
            } else {
                chineseText.style.display = 'none';
            }

            progressText.innerText = `å–®å­— ${currentIndex + 1} / ${wordList.length}`;
            syllableBox.innerHTML = '';

            const parts = wordData.text.split(' ');
            
            parts.forEach((part, partIndex) => {
                const syllables = part.split('-');
                
                syllables.forEach((syl) => {
                    const span = document.createElement('span');
                    span.className = 'syllable';
                    span.innerText = syl;
                    syllableBox.appendChild(span);
                });

                if (partIndex < parts.length - 1) {
                    const space = document.createElement('span');
                    space.style.width = "20px";
                    syllableBox.appendChild(space);
                }
            });
        }

        // 6. ç™¼éŸ³é‚è¼¯
        function speakCurrentWord() {
            if (wordList.length === 0) return;

            const wordData = wordList[currentIndex];
            const utterance = new SpeechSynthesisUtterance(wordData.full);
            
            if (selectedVoice) {
                utterance.voice = selectedVoice;
            } else {
                utterance.lang = 'en-US'; 
            }
            
            const rate = document.getElementById('rateRange').value;
            utterance.rate = parseFloat(rate);

            window.speechSynthesis.cancel(); 
            window.speechSynthesis.speak(utterance);

            const card = document.querySelector('.card');
            card.style.transform = "scale(1.02)";
            setTimeout(() => { card.style.transform = "scale(1)"; }, 200);
        }
    </script>
</body>
</html>
