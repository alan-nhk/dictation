<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¸æ ¡ç”Ÿè©å¡ (DIYç‰ˆ)</title>
    <style>
        :root {
            --primary-color: #4facfe;
            --secondary-color: #00f2fe;
            --accent-color: #ff9a9e;
            --text-color: #333;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            background-image: linear-gradient(120deg, #e0c3fc 0%, #8ec5fc 100%);
            min-height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            text-align: center;
            width: 100%;
            max-width: 600px;
        }

        /* å…©ç¨®æ¨¡å¼åˆ‡æ› */
        .mode-section {
            display: none; /* é è¨­éš±è—ï¼Œç”± JS æ§åˆ¶é¡¯ç¤º */
            animation: fadeIn 0.5s;
        }

        .mode-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ç·¨è¼¯å€æ¨£å¼ */
        .edit-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: left;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 15px;
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            box-sizing: border-box;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        select, input[type="range"] {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #ddd;
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .helper-text {
            font-size: 0.9rem;
            color: #888;
            margin-top: 5px;
        }

        /* å­¸ç¿’å¡æ¨£å¼ (ä¿æŒåŸæ¨£ä½†å¾®èª¿) */
        .card {
            background: var(--card-bg);
            border-radius: 30px;
            padding: 40px 20px;
            box-shadow: 0 15px 35px rgba(50, 50, 93, 0.1), 0 5px 15px rgba(0, 0, 0, 0.07);
            position: relative;
            transition: transform 0.3s ease;
            margin-bottom: 20px;
        }

        /* éŸ³ç¯€é¡¯ç¤ºå€ */
        .syllable-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            margin: 30px 0;
            cursor: pointer;
        }

        .syllable {
            font-size: 3.5rem;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 15px;
            transition: all 0.2s;
            user-select: none;
        }

        .syllable:nth-child(odd) { color: #2b5876; background-color: #e6f1f9; }
        .syllable:nth-child(even) { color: #d9475c; background-color: #ffe6e9; }
        .syllable:active { transform: scale(0.95); background-color: #ffff00; }

        .chinese-meaning {
            font-size: 1.8rem;
            color: #666;
            margin-bottom: 40px;
            font-weight: 500;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .btn {
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.2s;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
        }

        .btn:active { transform: scale(0.95); }
        
        .btn-primary { background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%); }
        .btn-success { background: linear-gradient(to right, #43e97b 0%, #38f9d7 100%); color: #333; }
        .btn-warning { background: linear-gradient(to right, #fa709a 0%, #fee140 100%); }
        .btn-secondary { background: #eee; color: #555; }

        .edit-btn-container {
            margin-top: 20px;
        }

        /* æ‰‹æ©Ÿç‰ˆèª¿æ•´ */
        @media (max-width: 600px) {
            .syllable { font-size: 2.2rem; }
            .card { padding: 30px 15px; }
            .btn { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>

    <div class="container">
        
        <!-- 1. ç·¨è¼¯èˆ‡è¨­å®šæ¨¡å¼ -->
        <div id="editMode" class="mode-section active">
            <h1 style="color:white; text-shadow: 1px 1px 2px rgba(0,0,0,0.2);">ğŸ“ è¨­å®šç”Ÿè©èˆ‡èªéŸ³</h1>
            
            <div class="edit-card">
                <div class="input-group">
                    <label for="wordInput">è¼¸å…¥ç”Ÿè© (ä¸€è¡Œä¸€å€‹)</label>
                    <div class="helper-text">æ ¼å¼ï¼šéŸ³ç¯€-éŸ³ç¯€ : ä¸­æ–‡æ„æ€</div>
                    <textarea id="wordInput" placeholder="ex-pe-ri-ment : å¯¦é©—&#10;class-room : æ•™å®¤"></textarea>
                </div>

                <div class="input-group">
                    <label for="voiceSelect">é¸æ“‡ç™¼éŸ³ (Voice)</label>
                    <select id="voiceSelect">
                        <option value="">è¼‰å…¥èªéŸ³ä¸­...</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="rateRange">æœ—è®€é€Ÿåº¦ (Speed): <span id="rateValue">0.8</span></label>
                    <input type="range" id="rateRange" min="0.5" max="1.5" step="0.1" value="0.8">
                </div>

                <button class="btn btn-success" onclick="startLearning()" style="width:100%; justify-content: center;">
                    é–‹å§‹å­¸ç¿’ (Start) â–¶
                </button>
            </div>
        </div>

        <!-- 2. å­¸ç¿’å¡ç‰‡æ¨¡å¼ -->
        <div id="learningMode" class="mode-section">
            <h1 id="title">ğŸ« å­¸ç¿’ä¸­</h1>
            
            <div class="card">
                <div class="chinese-meaning" id="chineseText">æº–å‚™å¥½äº†å—ï¼Ÿ</div>
                
                <div class="syllable-container" id="syllableBox" onclick="speakCurrentWord()">
                    <span class="syllable" style="background:none; color:#333;">Start!</span>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" onclick="speakCurrentWord()">
                        <span>ğŸ”Š</span> è®€éŸ³
                    </button>
                    <button class="btn btn-warning" onclick="nextWord()">
                        ä¸‹ä¸€å€‹ <span>â¡</span>
                    </button>
                </div>
            </div>

            <div class="edit-btn-container">
                <button class="btn btn-secondary" onclick="showEditMode()" style="background: rgba(255,255,255,0.3); color: white;">
                    âœï¸ ä¿®æ”¹ç”Ÿè© / è¨­å®š
                </button>
            </div>
            <div style="margin-top:10px; color: white;" id="progressText"></div>
        </div>

    </div>

    <script>
        // é è¨­è³‡æ–™
        const defaultData = `ex-pe-ri-ment : å¯¦é©—
class-room : æ•™å®¤
mu-sic room : éŸ³æ¨‚å®¤
com-pu-ter room : é›»è…¦å®¤
li-bra-ry : åœ–æ›¸é¤¨
play-ground : æ“å ´
wash-rooms : æ´—æ‰‹é–“`;

        let wordList = [];
        let currentIndex = -1;
        let selectedVoice = null;
        
        // åˆå§‹åŒ–
        window.onload = function() {
            document.getElementById('wordInput').value = defaultData;
            loadVoices();
            
            // ç›£è½èªé€Ÿæ‹‰æ¡¿è®ŠåŒ–
            document.getElementById('rateRange').addEventListener('input', function(e) {
                document.getElementById('rateValue').innerText = e.target.value;
            });
        };

        // 1. è¼‰å…¥èªéŸ³åˆ—è¡¨
        function loadVoices() {
            const voiceSelect = document.getElementById('voiceSelect');
            
            function populate() {
                const voices = window.speechSynthesis.getVoices();
                voiceSelect.innerHTML = '';
                
                // ç¯©é¸å‡ºè‹±æ–‡èªéŸ³ï¼Œå¦‚æœæ²’æœ‰è‹±æ–‡å°±é¡¯ç¤ºå…¨éƒ¨
                const englishVoices = voices.filter(v => v.lang.startsWith('en'));
                const voicesToShow = englishVoices.length > 0 ? englishVoices : voices;

                voicesToShow.forEach((voice, index) => {
                    const option = document.createElement('option');
                    option.textContent = `${voice.name} (${voice.lang})`;
                    option.value = index; // ç”¨ index æ¯”è¼ƒç°¡å–®å®šä½
                    // å˜—è©¦é é¸ Google US English æˆ– Microsoft Zira
                    if (voice.name.includes('Google US') || voice.name.includes('Zira')) {
                        option.selected = true;
                    }
                    option.dataVoice = voice; // æš«å­˜ç‰©ä»¶ (é›–ç„¶ select value å­˜ä¸äº†ç‰©ä»¶)
                    voiceSelect.appendChild(option);
                });

                if (voices.length === 0) {
                    const option = document.createElement('option');
                    option.textContent = "æœªåµæ¸¬åˆ°èªéŸ³ï¼Œå°‡ä½¿ç”¨é è¨­å€¼";
                    voiceSelect.appendChild(option);
                }
            }

            populate();
            // æŸäº›ç€è¦½å™¨éœ€è¦é€™å€‹äº‹ä»¶æ‰èƒ½æŠ“åˆ°èªéŸ³
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = populate;
            }
        }

        // 2. è§£æè¼¸å…¥ä¸¦é–‹å§‹å­¸ç¿’
        function startLearning() {
            const rawInput = document.getElementById('wordInput').value;
            const lines = rawInput.split('\n');
            wordList = [];

            lines.forEach(line => {
                // æ”¯æ´ä¸­æ–‡å†’è™Ÿæˆ–è‹±æ–‡å†’è™Ÿ
                let separator = line.includes(':') ? ':' : 'ï¼š';
                if (!line.includes(separator)) return; // è·³éæ ¼å¼éŒ¯èª¤çš„è¡Œ

                const [syllablePart, meaningPart] = line.split(separator);
                if (syllablePart && meaningPart) {
                    const cleanSyllable = syllablePart.trim();
                    const cleanMeaning = meaningPart.trim();
                    const fullWord = cleanSyllable.replace(/-/g, ''); // å»æ‰ - è®Šæˆå®Œæ•´å–®å­—
                    
                    wordList.push({
                        text: cleanSyllable,
                        chinese: cleanMeaning,
                        full: fullWord
                    });
                }
            });

            if (wordList.length === 0) {
                alert("è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹ç”Ÿè©ï¼æ ¼å¼ï¼šword : æ„æ€");
                return;
            }

            // ç²å–é¸æ“‡çš„èªéŸ³ç‰©ä»¶
            const voices = window.speechSynthesis.getVoices();
            // é€™è£¡é‡æ–°ç¯©é¸ä¸€æ¬¡ä»¥ç¢ºä¿ index å°æ‡‰æ­£ç¢º (å¦‚æœåšäº† filter)
            const englishVoices = voices.filter(v => v.lang.startsWith('en'));
            const voicesToShow = englishVoices.length > 0 ? englishVoices : voices;
            
            const selectedIndex = document.getElementById('voiceSelect').selectedIndex;
            if (selectedIndex >= 0 && selectedIndex < voicesToShow.length) {
                selectedVoice = voicesToShow[selectedIndex];
            } else {
                selectedVoice = null;
            }

            // åˆ‡æ›ä»‹é¢
            document.getElementById('editMode').classList.remove('active');
            document.getElementById('learningMode').classList.add('active');
            
            currentIndex = 0;
            updateDisplay();
            // é è®€ç¬¬ä¸€å€‹å­— (å¯èƒ½è¢«ç€è¦½å™¨é˜»æ“‹ï¼Œè¦–æƒ…æ³)
            setTimeout(speakCurrentWord, 500);
        }

        // 3. è¿”å›ç·¨è¼¯æ¨¡å¼
        function showEditMode() {
            document.getElementById('learningMode').classList.remove('active');
            document.getElementById('editMode').classList.add('active');
            window.speechSynthesis.cancel();
        }

        // 4. ä¸‹ä¸€å€‹å­—
        function nextWord() {
            currentIndex++;
            if (currentIndex >= wordList.length) {
                currentIndex = 0;
            }
            updateDisplay();
            setTimeout(speakCurrentWord, 300);
        }

        // 5. æ›´æ–°ç•«é¢é¡¯ç¤º
        function updateDisplay() {
            const wordData = wordList[currentIndex];
            const syllableBox = document.getElementById('syllableBox');
            const chineseText = document.getElementById('chineseText');
            const progressText = document.getElementById('progressText');

            chineseText.innerText = wordData.chinese;
            progressText.innerText = `å–®å­— ${currentIndex + 1} / ${wordList.length}`;
            syllableBox.innerHTML = '';

            // è™•ç†ç©ºæ ¼ (ç‰‡èª) å’Œé€£å­—è™Ÿ (éŸ³ç¯€)
            // é‚è¼¯ï¼šå…ˆç”¨ç©ºæ ¼åˆ‡é–‹å–®å­—ï¼Œå†ç”¨é€£å­—è™Ÿåˆ‡é–‹éŸ³ç¯€
            const parts = wordData.text.split(' ');
            
            parts.forEach((part, partIndex) => {
                const syllables = part.split('-');
                
                syllables.forEach((syl) => {
                    const span = document.createElement('span');
                    span.className = 'syllable';
                    span.innerText = syl;
                    syllableBox.appendChild(span);
                });

                if (partIndex < parts.length - 1) {
                    const space = document.createElement('span');
                    space.style.width = "20px";
                    syllableBox.appendChild(space);
                }
            });
        }

        // 6. ç™¼éŸ³é‚è¼¯
        function speakCurrentWord() {
            if (wordList.length === 0) return;

            const wordData = wordList[currentIndex];
            const utterance = new SpeechSynthesisUtterance(wordData.full);
            
            // å¥—ç”¨ä½¿ç”¨è€…è¨­å®š
            if (selectedVoice) {
                utterance.voice = selectedVoice;
            } else {
                utterance.lang = 'en-US'; 
            }
            
            const rate = document.getElementById('rateRange').value;
            utterance.rate = parseFloat(rate);

            window.speechSynthesis.cancel(); 
            window.speechSynthesis.speak(utterance);

            // å‹•ç•«
            const card = document.querySelector('.card');
            card.style.transform = "scale(1.02)";
            setTimeout(() => { card.style.transform = "scale(1)"; }, 200);
        }
    </script>
</body>
</html>
